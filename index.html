<!DOCTYPE html>
<html>
  <head>
    <style>
      html, body {
        margin: 0;
        padding: 0;

        overflow: hidden;
      }
    </style>
    <script>
      window.addEventListener('load', _ => {
        let audio = []

        const bar =  {
          width: window.innerWidth / 128 - 8,
          height: 100,
          padding: 8
        }

        const canvas = document.createElement('canvas')
        const context = canvas.getContext('2d')

        canvas.width = window.innerWidth
        canvas.height = window.innerHeight

        document.body.appendChild(canvas)

        const listener = arr => {
          audio = arr
        }

        const draw = _ => {
          context.clearRect(0,0, window.innerWidth, innerHeight)
          for (const [i, part] of audio.entries()) {
            const x = (i * bar.width) + ((i + 1) * bar.padding) - (bar.padding / 2)

            const y = 4

            context.fillRect(x,y,bar.width,bar.height * part)
          }

          requestAnimationFrame(draw);
        }


        window.wallpaperRegisterAudioListener(listener)

        draw()
      })
    </script>
  </head>
  <body>
  </body>
</html>
